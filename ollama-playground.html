<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ollama API Playground - qwen3</title>
<style>
  :root {
    --bg: #0f172a;
    --surface: #1e293b;
    --surface2: #334155;
    --border: #475569;
    --text: #e2e8f0;
    --text2: #94a3b8;
    --accent: #3b82f6;
    --accent2: #2563eb;
    --green: #22c55e;
    --red: #ef4444;
    --orange: #f59e0b;
    --purple: #a78bfa;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
  }
  /* Header */
  .header {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 12px 24px;
    display: flex;
    align-items: center;
    gap: 16px;
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .header h1 { font-size: 18px; font-weight: 600; }
  .header h1 span { color: var(--accent); }
  .server-status {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-left: auto;
    font-size: 13px;
    color: var(--text2);
  }
  .status-dot {
    width: 8px; height: 8px; border-radius: 50%;
    background: var(--red);
  }
  .status-dot.ok { background: var(--green); }
  .server-url-input {
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 13px;
    width: 260px;
  }
  /* Layout */
  .layout {
    display: grid;
    grid-template-columns: 220px 1fr 380px;
    height: calc(100vh - 53px);
  }
  /* Sidebar */
  .sidebar {
    background: var(--surface);
    border-right: 1px solid var(--border);
    overflow-y: auto;
    padding: 12px 0;
  }
  .sidebar-group { margin-bottom: 8px; }
  .sidebar-group-title {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text2);
    padding: 8px 16px 4px;
    font-weight: 600;
  }
  .sidebar-item {
    padding: 8px 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    transition: background 0.15s;
  }
  .sidebar-item:hover { background: var(--surface2); }
  .sidebar-item.active { background: var(--accent2); color: white; }
  .method-badge {
    font-size: 10px;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 3px;
    min-width: 36px;
    text-align: center;
  }
  .method-badge.get { background: #065f46; color: #6ee7b7; }
  .method-badge.post { background: #1e3a5f; color: #93c5fd; }
  .method-badge.delete { background: #7f1d1d; color: #fca5a5; }
  .method-badge.head { background: #4a1d96; color: #c4b5fd; }
  /* Main */
  .main { overflow-y: auto; padding: 24px; }
  .endpoint-title {
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 4px;
  }
  .endpoint-path {
    font-family: 'JetBrains Mono', monospace;
    color: var(--accent);
    font-size: 14px;
    margin-bottom: 16px;
  }
  .endpoint-desc {
    color: var(--text2);
    font-size: 14px;
    line-height: 1.6;
    margin-bottom: 20px;
  }
  /* Tabs */
  .tabs {
    display: flex;
    gap: 0;
    border-bottom: 1px solid var(--border);
    margin-bottom: 20px;
  }
  .tab {
    padding: 10px 20px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
    color: var(--text2);
    border-bottom: 2px solid transparent;
    transition: all 0.15s;
  }
  .tab:hover { color: var(--text); }
  .tab.active { color: var(--accent); border-bottom-color: var(--accent); }
  .tab-content { display: none; }
  .tab-content.active { display: block; }
  /* Form */
  .form-group { margin-bottom: 16px; }
  .form-label {
    display: block;
    font-size: 12px;
    font-weight: 600;
    color: var(--text2);
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .form-input, .form-select, .form-textarea {
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 10px 12px;
    border-radius: 8px;
    font-size: 14px;
    transition: border-color 0.15s;
  }
  .form-input:focus, .form-select:focus, .form-textarea:focus {
    outline: none;
    border-color: var(--accent);
  }
  .form-textarea {
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    resize: vertical;
    min-height: 80px;
  }
  .form-hint {
    font-size: 11px;
    color: var(--text2);
    margin-top: 4px;
    line-height: 1.4;
  }
  /* Slider */
  .slider-group {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 12px;
    align-items: center;
  }
  .slider-row {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  input[type="range"] {
    flex: 1;
    -webkit-appearance: none;
    height: 4px;
    background: var(--surface2);
    border-radius: 2px;
    outline: none;
  }
  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 16px; height: 16px;
    background: var(--accent);
    border-radius: 50%;
    cursor: pointer;
  }
  .slider-value {
    background: var(--surface2);
    padding: 4px 10px;
    border-radius: 4px;
    font-size: 13px;
    font-family: monospace;
    min-width: 50px;
    text-align: center;
  }
  /* Toggle */
  .toggle-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 0;
  }
  .toggle-label { font-size: 13px; }
  .toggle {
    position: relative;
    width: 40px; height: 22px;
    cursor: pointer;
  }
  .toggle input { display: none; }
  .toggle-slider {
    position: absolute;
    inset: 0;
    background: var(--surface2);
    border-radius: 11px;
    transition: background 0.2s;
  }
  .toggle-slider::after {
    content: '';
    position: absolute;
    top: 3px; left: 3px;
    width: 16px; height: 16px;
    background: white;
    border-radius: 50%;
    transition: transform 0.2s;
  }
  .toggle input:checked + .toggle-slider { background: var(--accent); }
  .toggle input:checked + .toggle-slider::after { transform: translateX(18px); }
  /* Accordion */
  .accordion { border: 1px solid var(--border); border-radius: 8px; margin-bottom: 16px; }
  .accordion-header {
    padding: 12px 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 14px;
    font-weight: 600;
    background: var(--surface);
    border-radius: 8px;
    user-select: none;
  }
  .accordion-header:hover { background: var(--surface2); }
  .accordion-arrow { transition: transform 0.2s; font-size: 12px; }
  .accordion.open .accordion-arrow { transform: rotate(90deg); }
  .accordion-body { display: none; padding: 16px; border-top: 1px solid var(--border); }
  .accordion.open .accordion-body { display: block; }
  /* Button */
  .btn {
    padding: 10px 24px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.15s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  .btn-primary { background: var(--accent); color: white; }
  .btn-primary:hover { background: var(--accent2); }
  .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
  .btn-secondary { background: var(--surface2); color: var(--text); }
  .btn-secondary:hover { background: var(--border); }
  .btn-sm { padding: 6px 12px; font-size: 12px; }
  /* Response panel */
  .response-panel {
    background: var(--surface);
    border-left: 1px solid var(--border);
    display: flex;
    flex-direction: column;
  }
  .response-header {
    padding: 12px 16px;
    border-bottom: 1px solid var(--border);
    font-size: 13px;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .response-status {
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
  }
  .response-status.s200 { background: #065f46; color: #6ee7b7; }
  .response-status.s400 { background: #7f1d1d; color: #fca5a5; }
  .response-status.s404 { background: #78350f; color: #fcd34d; }
  .response-body {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
  }
  .response-pre {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    line-height: 1.6;
    white-space: pre-wrap;
    word-break: break-word;
    color: var(--text);
  }
  .response-meta {
    padding: 12px 16px;
    border-top: 1px solid var(--border);
    font-size: 12px;
    color: var(--text2);
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
  }
  .meta-item span { color: var(--text); font-weight: 600; }
  /* Messages builder */
  .message-list { display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; }
  .message-item {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px;
  }
  .message-item-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
  }
  .message-role-select {
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
  }
  .message-remove {
    margin-left: auto;
    background: none;
    border: none;
    color: var(--red);
    cursor: pointer;
    font-size: 16px;
    padding: 2px 6px;
    border-radius: 4px;
  }
  .message-remove:hover { background: rgba(239,68,68,0.1); }
  .message-content-input {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 8px;
    border-radius: 4px;
    font-size: 13px;
    resize: vertical;
    min-height: 40px;
    font-family: inherit;
  }
  /* Tools builder */
  .tool-item {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 8px;
  }
  .tool-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px; }
  .tool-input {
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 13px;
    width: 100%;
  }
  .tool-params-area {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 8px;
    border-radius: 4px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    resize: vertical;
    min-height: 60px;
  }
  /* Thinking block */
  .thinking-block {
    background: rgba(167, 139, 250, 0.1);
    border-left: 3px solid var(--purple);
    padding: 12px;
    margin-bottom: 12px;
    border-radius: 0 8px 8px 0;
    font-size: 13px;
    line-height: 1.5;
  }
  .thinking-label {
    font-size: 11px;
    font-weight: 700;
    color: var(--purple);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 6px;
  }
  .response-text {
    font-size: 14px;
    line-height: 1.7;
    white-space: pre-wrap;
  }
  /* Presets */
  .presets { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 16px; }
  .preset-chip {
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--text2);
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.15s;
  }
  .preset-chip:hover { background: var(--accent); color: white; border-color: var(--accent); }
  /* Loading */
  .spinner {
    width: 20px; height: 20px;
    border: 2px solid var(--surface2);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    display: inline-block;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  /* Scrollbar */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--surface2); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--border); }
  /* Responsive */
  @media (max-width: 1200px) {
    .layout { grid-template-columns: 200px 1fr 320px; }
  }
  @media (max-width: 900px) {
    .layout { grid-template-columns: 1fr; grid-template-rows: auto 1fr auto; }
    .sidebar { display: flex; overflow-x: auto; padding: 8px; gap: 4px; border-right: none; border-bottom: 1px solid var(--border); }
    .sidebar-group { display: flex; gap: 4px; margin: 0; }
    .sidebar-group-title { display: none; }
    .sidebar-item { white-space: nowrap; padding: 6px 10px; border-radius: 6px; }
    .response-panel { border-left: none; border-top: 1px solid var(--border); max-height: 50vh; }
  }
</style>
</head>
<body>

<div class="header">
  <h1><span>Ollama</span> API Playground</h1>
  <div class="server-status">
    <input type="text" class="server-url-input" id="serverUrl" value="http://192.168.1.8:11434" placeholder="Ollama Server URL">
    <button class="btn btn-sm btn-secondary" onclick="checkServer()">Baglan</button>
    <div class="status-dot" id="statusDot"></div>
    <span id="statusText">Baglaniyor...</span>
  </div>
</div>

<div class="layout">
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar"></div>

  <!-- Main -->
  <div class="main" id="mainContent"></div>

  <!-- Response Panel -->
  <div class="response-panel">
    <div class="response-header">
      <span>Yanit</span>
      <span class="response-status" id="respStatus" style="display:none"></span>
    </div>
    <div class="response-body" id="responseBody">
      <div style="color:var(--text2); text-align:center; padding:40px 20px;">
        <div style="font-size:40px; margin-bottom:12px;">&#8592;</div>
        <div>Bir endpoint secip istek gonderin</div>
      </div>
    </div>
    <div class="response-meta" id="responseMeta" style="display:none"></div>
  </div>
</div>

<script>
// ===== ENDPOINTS =====
const ENDPOINTS = [
  {
    group: "Metin Uretme",
    items: [
      {
        id: "generate",
        method: "POST",
        path: "/api/generate",
        title: "Generate - Metin Uretme",
        desc: "Verilen prompt'a gore metin uretir. Thinking mode ve JSON format destekler.",
        type: "generate"
      },
      {
        id: "chat",
        method: "POST",
        path: "/api/chat",
        title: "Chat - Sohbet",
        desc: "Mesaj tabanli sohbet. Cok turlu konusma, thinking mode, tool calling destekler.",
        type: "chat"
      },
      {
        id: "embed",
        method: "POST",
        path: "/api/embed",
        title: "Embed - Embedding",
        desc: "Metin icin embedding vektoru uretir. nomic-embed-text modeli kullanilir.",
        type: "embed"
      }
    ]
  },
  {
    group: "Model Yonetimi",
    items: [
      { id: "tags", method: "GET", path: "/api/tags", title: "Yuklu Modeller", desc: "Sistemdeki tum modelleri listeler.", type: "simple-get" },
      { id: "ps", method: "GET", path: "/api/ps", title: "Calisan Modeller", desc: "Bellekte yuklu olan modelleri gosterir.", type: "simple-get" },
      { id: "show", method: "POST", path: "/api/show", title: "Model Detayi", desc: "Modelin Modelfile, parametreler, template bilgilerini gosterir.", type: "show" },
      { id: "pull", method: "POST", path: "/api/pull", title: "Model Indir", desc: "Ollama kutuphanesinden model indirir.", type: "pull" },
      { id: "create", method: "POST", path: "/api/create", title: "Model Olustur", desc: "Modelfile ile ozel model olusturur.", type: "create" },
      { id: "copy", method: "POST", path: "/api/copy", title: "Model Kopyala", desc: "Mevcut modeli yeni isimle kopyalar.", type: "copy" },
      { id: "delete", method: "DELETE", path: "/api/delete", title: "Model Sil", desc: "Belirtilen modeli siler.", type: "delete" }
    ]
  },
  {
    group: "Sistem",
    items: [
      { id: "version", method: "GET", path: "/api/version", title: "Versiyon", desc: "Ollama sunucu versiyonu.", type: "simple-get" },
      { id: "root", method: "GET", path: "/", title: "Durum Kontrolu", desc: "Sunucunun calisip calismadigini kontrol eder.", type: "simple-get" }
    ]
  }
];

let currentEndpoint = null;
let availableModels = [];
let isLoading = false;

// ===== INIT =====
function init() {
  renderSidebar();
  checkServer();
  selectEndpoint("chat");
}

function renderSidebar() {
  const sb = document.getElementById("sidebar");
  sb.innerHTML = ENDPOINTS.map(g => `
    <div class="sidebar-group">
      <div class="sidebar-group-title">${g.group}</div>
      ${g.items.map(e => `
        <div class="sidebar-item" data-id="${e.id}" onclick="selectEndpoint('${e.id}')">
          <span class="method-badge ${e.method.toLowerCase()}">${e.method}</span>
          <span>${e.title.split(" - ")[0]}</span>
        </div>
      `).join("")}
    </div>
  `).join("");
}

async function checkServer() {
  const url = document.getElementById("serverUrl").value.replace(/\/+$/, "");
  const dot = document.getElementById("statusDot");
  const txt = document.getElementById("statusText");
  try {
    const r = await fetch(url + "/api/version");
    const d = await r.json();
    dot.className = "status-dot ok";
    txt.textContent = "v" + d.version;
    // Modelleri al
    const mr = await fetch(url + "/api/tags");
    const md = await mr.json();
    availableModels = md.models.map(m => m.name);
    // Seçili endpoint varsa model listesini güncelle
    if (currentEndpoint) selectEndpoint(currentEndpoint.id);
  } catch(e) {
    dot.className = "status-dot";
    txt.textContent = "Baglanti yok";
    availableModels = ["qwen3:4b", "qwen3:8b", "nomic-embed-text:latest"];
  }
}

function selectEndpoint(id) {
  let ep = null;
  ENDPOINTS.forEach(g => g.items.forEach(e => { if(e.id === id) ep = e; }));
  if(!ep) return;
  currentEndpoint = ep;

  // Sidebar active
  document.querySelectorAll(".sidebar-item").forEach(el => {
    el.classList.toggle("active", el.dataset.id === id);
  });

  const main = document.getElementById("mainContent");

  switch(ep.type) {
    case "chat": main.innerHTML = renderChatForm(ep); break;
    case "generate": main.innerHTML = renderGenerateForm(ep); break;
    case "embed": main.innerHTML = renderEmbedForm(ep); break;
    case "simple-get": main.innerHTML = renderSimpleGet(ep); break;
    case "show": main.innerHTML = renderShowForm(ep); break;
    case "pull": main.innerHTML = renderPullForm(ep); break;
    case "create": main.innerHTML = renderCreateForm(ep); break;
    case "copy": main.innerHTML = renderCopyForm(ep); break;
    case "delete": main.innerHTML = renderDeleteForm(ep); break;
    default: main.innerHTML = renderSimpleGet(ep);
  }
}

// ===== MODEL SELECT =====
function modelSelect(id, defaultVal, filter) {
  let models = availableModels;
  if (filter) models = models.filter(filter);
  if (models.length === 0) models = [defaultVal];
  return `<select class="form-select" id="${id}">
    ${models.map(m => `<option value="${m}" ${m.includes(defaultVal)?'selected':''}>${m}</option>`).join("")}
  </select>`;
}

// ===== SLIDER =====
function slider(id, label, min, max, step, value, hint) {
  return `<div class="form-group">
    <label class="form-label">${label}</label>
    <div class="slider-row">
      <input type="range" id="${id}" min="${min}" max="${max}" step="${step}" value="${value}"
        oninput="document.getElementById('${id}_val').textContent=this.value">
      <span class="slider-value" id="${id}_val">${value}</span>
    </div>
    ${hint ? `<div class="form-hint">${hint}</div>` : ''}
  </div>`;
}

// ===== TOGGLE =====
function toggle(id, label, checked) {
  return `<div class="toggle-row">
    <span class="toggle-label">${label}</span>
    <label class="toggle"><input type="checkbox" id="${id}" ${checked?'checked':''}><span class="toggle-slider"></span></label>
  </div>`;
}

// ===== OPTIONS ACCORDION =====
function optionsAccordion() {
  return `
  <div class="accordion" id="optionsAccordion" onclick="this.classList.toggle('open')">
    <div class="accordion-header">
      <span>Model Parametreleri (Options)</span>
      <span class="accordion-arrow">&#9654;</span>
    </div>
    <div class="accordion-body" onclick="event.stopPropagation()">
      ${slider("opt_temperature", "Temperature", 0, 2, 0.05, 0.6, "Rastgelelik. 0=deterministik, 0.6=varsayilan, 1+=yaratici")}
      ${slider("opt_top_p", "Top P (Nucleus Sampling)", 0, 1, 0.01, 0.95, "Kumulatif olasilik esigi. 0.95=varsayilan")}
      ${slider("opt_top_k", "Top K", 0, 200, 1, 20, "En yuksek olasilikli K token. 20=varsayilan, 0=devre disi")}
      ${slider("opt_repeat_penalty", "Repeat Penalty", 0.5, 2, 0.05, 1.0, "Tekrar cezasi. 1.0=ceza yok (varsayilan)")}
      ${slider("opt_num_predict", "Max Tokens (num_predict)", -2, 8192, 1, -1, "Maks uretilecek token. -1=sinirsiz, -2=context doldur")}
      ${slider("opt_num_ctx", "Context Window (num_ctx)", 512, 131072, 512, 32768, "Context penceresi. Max 262144 (yuksek VRAM gerekir)")}
      ${slider("opt_repeat_last_n", "Repeat Last N", -1, 512, 1, 64, "Tekrar cezasi icin geriye bakilacak token. -1=tum context")}
      ${slider("opt_frequency_penalty", "Frequency Penalty", 0, 2, 0.05, 0, "Frekans cezasi. Token tekrar sayisina gore")}
      ${slider("opt_presence_penalty", "Presence Penalty", 0, 2, 0.05, 0, "Varlik cezasi. Yeni konulara gecisi tesvik eder")}
      ${slider("opt_seed", "Seed", 0, 99999, 1, 0, "Rastgele tohum. 0=rastgele, diger=tekrarlanabilir sonuc")}

      <div class="accordion" onclick="this.classList.toggle('open'); event.stopPropagation();">
        <div class="accordion-header">
          <span>Gelismis Sampling</span>
          <span class="accordion-arrow">&#9654;</span>
        </div>
        <div class="accordion-body" onclick="event.stopPropagation()">
          ${slider("opt_min_p", "Min P", 0, 1, 0.01, 0, "Minimum olasilik esigi. 0=devre disi")}
          ${slider("opt_tfs_z", "TFS Z (Tail-Free Sampling)", 0, 2, 0.05, 1.0, "1.0=devre disi, 0.5-0.9=kuyruk kesme")}
          ${slider("opt_typical_p", "Typical P", 0, 1, 0.01, 1.0, "1.0=devre disi, 0.7-0.9=tutarli metin")}
          <div class="form-group">
            <label class="form-label">Mirostat</label>
            <select class="form-select" id="opt_mirostat">
              <option value="0" selected>0 - Devre Disi (varsayilan)</option>
              <option value="1">1 - Mirostat v1</option>
              <option value="2">2 - Mirostat v2 (onerilen)</option>
            </select>
            <div class="form-hint">Perplexity sabit tutarak kaliteyi artirir</div>
          </div>
          ${slider("opt_mirostat_tau", "Mirostat Tau", 0, 10, 0.1, 5.0, "Hedef perplexity. 5.0=varsayilan")}
          ${slider("opt_mirostat_eta", "Mirostat Eta", 0, 1, 0.01, 0.1, "Ogrenme orani. 0.1=varsayilan")}
        </div>
      </div>

      <div class="accordion" onclick="this.classList.toggle('open'); event.stopPropagation();">
        <div class="accordion-header">
          <span>Donanim / Performans</span>
          <span class="accordion-arrow">&#9654;</span>
        </div>
        <div class="accordion-body" onclick="event.stopPropagation()">
          ${slider("opt_num_gpu", "GPU Katman Sayisi", -1, 100, 1, -1, "-1=tum katmanlar GPU'da, 0=sadece CPU")}
          ${slider("opt_num_thread", "CPU Thread", 0, 32, 1, 0, "0=otomatik")}
          ${toggle("opt_low_vram", "Dusuk VRAM Modu", false)}
          ${toggle("opt_f16_kv", "FP16 KV Cache", true)}
          ${toggle("opt_use_mmap", "Memory-Mapped Dosya", true)}
          ${toggle("opt_use_mlock", "RAM Kilidi (mlock)", false)}
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Stop Dizileri</label>
        <input type="text" class="form-input" id="opt_stop" placeholder='Ornek: \\nHuman:,###,STOP'>
        <div class="form-hint">Virgul ile ayrilmis durma dizileri. Bu diziler uretilince metin durur.</div>
      </div>

      <div class="form-group">
        <label class="form-label">Keep Alive</label>
        <input type="text" class="form-input" id="opt_keep_alive" value="5m" placeholder="5m">
        <div class="form-hint">Model bellekte kalma suresi. 0=hemen kaldir, -1=suresiz</div>
      </div>
    </div>
  </div>`;
}

function getOptions() {
  const opts = {};
  const sliders = {
    temperature: "opt_temperature",
    top_p: "opt_top_p",
    top_k: "opt_top_k",
    repeat_penalty: "opt_repeat_penalty",
    num_predict: "opt_num_predict",
    num_ctx: "opt_num_ctx",
    repeat_last_n: "opt_repeat_last_n",
    frequency_penalty: "opt_frequency_penalty",
    presence_penalty: "opt_presence_penalty",
    seed: "opt_seed",
    min_p: "opt_min_p",
    tfs_z: "opt_tfs_z",
    typical_p: "opt_typical_p",
    mirostat_tau: "opt_mirostat_tau",
    mirostat_eta: "opt_mirostat_eta",
    num_gpu: "opt_num_gpu",
    num_thread: "opt_num_thread"
  };
  for (const [key, id] of Object.entries(sliders)) {
    const el = document.getElementById(id);
    if (el) opts[key] = parseFloat(el.value);
  }
  const mirostat = document.getElementById("opt_mirostat");
  if (mirostat) opts.mirostat = parseInt(mirostat.value);

  const bools = { low_vram: "opt_low_vram", f16_kv: "opt_f16_kv", use_mmap: "opt_use_mmap", use_mlock: "opt_use_mlock" };
  for (const [key, id] of Object.entries(bools)) {
    const el = document.getElementById(id);
    if (el) opts[key] = el.checked;
  }

  const stop = document.getElementById("opt_stop");
  if (stop && stop.value.trim()) {
    opts.stop = stop.value.split(",").map(s => s.trim().replace(/\\n/g, "\n"));
  }

  // Integer dönüşümleri
  ["top_k","num_predict","num_ctx","repeat_last_n","seed","mirostat","num_gpu","num_thread"].forEach(k => {
    if (opts[k] !== undefined) opts[k] = Math.round(opts[k]);
  });

  return opts;
}

// ===== CHAT FORM =====
function renderChatForm(ep) {
  return `
    <div class="endpoint-title">${ep.title}</div>
    <div class="endpoint-path">${ep.method} ${ep.path}</div>
    <div class="endpoint-desc">${ep.desc}</div>

    <div class="presets">
      <span class="preset-chip" onclick="applyPreset('creative')">Yaratici</span>
      <span class="preset-chip" onclick="applyPreset('precise')">Kesin/Teknik</span>
      <span class="preset-chip" onclick="applyPreset('balanced')">Dengeli</span>
      <span class="preset-chip" onclick="applyPreset('code')">Kod Yazimi</span>
    </div>

    <div class="form-group">
      <label class="form-label">Model</label>
      ${modelSelect("chatModel", "qwen3:4b", m => !m.includes("embed"))}
    </div>

    <div class="tabs">
      <div class="tab active" onclick="switchTab(this, 'chatMessages')">Mesajlar</div>
      <div class="tab" onclick="switchTab(this, 'chatTools')">Tool Calling</div>
      <div class="tab" onclick="switchTab(this, 'chatRaw')">Raw JSON</div>
    </div>

    <div class="tab-content active" id="chatMessages">
      <div class="form-group">
        <label class="form-label">System Prompt (opsiyonel)</label>
        <textarea class="form-textarea" id="chatSystem" rows="2" placeholder="Ornek: Sen yardimsever bir Turkce asistansin."></textarea>
      </div>
      <label class="form-label">Mesajlar</label>
      <div class="message-list" id="messageList">
        <div class="message-item">
          <div class="message-item-header">
            <select class="message-role-select" onchange="this.parentElement.parentElement.dataset.role=this.value">
              <option value="user" selected>user</option>
              <option value="assistant">assistant</option>
            </select>
            <button class="message-remove" onclick="this.closest('.message-item').remove()">x</button>
          </div>
          <textarea class="message-content-input" placeholder="Mesajinizi yazin..." rows="2">Merhaba, kendini kisaca tanit.</textarea>
        </div>
      </div>
      <button class="btn btn-sm btn-secondary" onclick="addMessage()">+ Mesaj Ekle</button>
    </div>

    <div class="tab-content" id="chatTools">
      <div class="form-hint" style="margin-bottom:12px;">qwen3:4b tool calling destekler. Fonksiyon tanimlari ekleyin, model gerektiginde cagirir.</div>
      <div id="toolsList"></div>
      <button class="btn btn-sm btn-secondary" onclick="addTool()">+ Tool Ekle</button>
      <button class="btn btn-sm btn-secondary" onclick="addSampleTool()" style="margin-left:8px;">Ornek Tool</button>
    </div>

    <div class="tab-content" id="chatRaw">
      <div class="form-group">
        <label class="form-label">Raw JSON Body</label>
        <textarea class="form-textarea" id="chatRawJson" rows="12" placeholder='{"model":"qwen3:4b","messages":[...]}'></textarea>
        <div class="form-hint">Tam JSON body girin. Diger alanlar yok sayilir.</div>
      </div>
    </div>

    <div style="margin-top:16px;">
      ${toggle("chatThinking", "Thinking Mode (/think)", false)}
      ${toggle("chatStream", "Stream", false)}
      <div class="form-group">
        <label class="form-label">Format</label>
        <select class="form-select" id="chatFormat">
          <option value="">Serbest metin (varsayilan)</option>
          <option value="json">JSON</option>
        </select>
      </div>
    </div>

    ${optionsAccordion()}

    <div style="margin-top:20px; display:flex; gap:8px;">
      <button class="btn btn-primary" id="sendBtn" onclick="sendChat()">
        Gonder
      </button>
      <button class="btn btn-secondary" onclick="showCurl('chat')">cURL Goster</button>
    </div>
  `;
}

function addMessage(role="user", content="") {
  const list = document.getElementById("messageList");
  const div = document.createElement("div");
  div.className = "message-item";
  div.innerHTML = `
    <div class="message-item-header">
      <select class="message-role-select" onchange="this.parentElement.parentElement.dataset.role=this.value">
        <option value="user" ${role==='user'?'selected':''}>user</option>
        <option value="assistant" ${role==='assistant'?'selected':''}>assistant</option>
        <option value="tool" ${role==='tool'?'selected':''}>tool</option>
      </select>
      <button class="message-remove" onclick="this.closest('.message-item').remove()">x</button>
    </div>
    <textarea class="message-content-input" placeholder="Mesajinizi yazin..." rows="2">${content}</textarea>
  `;
  list.appendChild(div);
}

function addTool() {
  const list = document.getElementById("toolsList");
  const div = document.createElement("div");
  div.className = "tool-item";
  div.innerHTML = `
    <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
      <strong style="font-size:13px;">Tool Tanimi</strong>
      <button class="message-remove" onclick="this.closest('.tool-item').remove()">x</button>
    </div>
    <div class="tool-row">
      <div><label class="form-label">Fonksiyon Adi</label><input class="tool-input" data-field="name" placeholder="get_weather"></div>
      <div><label class="form-label">Aciklama</label><input class="tool-input" data-field="desc" placeholder="Hava durumu bilgisi getirir"></div>
    </div>
    <label class="form-label">Parametreler (JSON Schema)</label>
    <textarea class="tool-params-area" data-field="params">{
  "type": "object",
  "properties": {
    "param1": {"type": "string", "description": "Aciklama"}
  },
  "required": ["param1"]
}</textarea>
  `;
  list.appendChild(div);
}

function addSampleTool() {
  const list = document.getElementById("toolsList");
  const div = document.createElement("div");
  div.className = "tool-item";
  div.innerHTML = `
    <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
      <strong style="font-size:13px;">Tool Tanimi</strong>
      <button class="message-remove" onclick="this.closest('.tool-item').remove()">x</button>
    </div>
    <div class="tool-row">
      <div><label class="form-label">Fonksiyon Adi</label><input class="tool-input" data-field="name" value="get_weather"></div>
      <div><label class="form-label">Aciklama</label><input class="tool-input" data-field="desc" value="Belirtilen sehir icin hava durumu bilgisi getirir"></div>
    </div>
    <label class="form-label">Parametreler (JSON Schema)</label>
    <textarea class="tool-params-area" data-field="params">{
  "type": "object",
  "properties": {
    "city": {"type": "string", "description": "Sehir adi"},
    "unit": {"type": "string", "enum": ["celsius", "fahrenheit"], "description": "Sicaklik birimi"}
  },
  "required": ["city"]
}</textarea>
  `;
  list.appendChild(div);
}

function getTools() {
  const items = document.querySelectorAll("#toolsList .tool-item");
  const tools = [];
  items.forEach(item => {
    const name = item.querySelector('[data-field="name"]').value.trim();
    const desc = item.querySelector('[data-field="desc"]').value.trim();
    const paramsStr = item.querySelector('[data-field="params"]').value.trim();
    if (!name) return;
    try {
      const params = JSON.parse(paramsStr);
      tools.push({ type: "function", function: { name, description: desc, parameters: params } });
    } catch(e) { /* skip */ }
  });
  return tools;
}

function getMessages() {
  const msgs = [];
  const sys = document.getElementById("chatSystem");
  if (sys && sys.value.trim()) {
    msgs.push({ role: "system", content: sys.value.trim() });
  }
  document.querySelectorAll("#messageList .message-item").forEach(item => {
    const role = item.querySelector(".message-role-select").value;
    const content = item.querySelector(".message-content-input").value;
    if (content.trim()) msgs.push({ role, content });
  });

  // Thinking mode
  const thinking = document.getElementById("chatThinking");
  if (thinking && thinking.checked && msgs.length > 0) {
    const last = msgs[msgs.length - 1];
    if (last.role === "user" && !last.content.startsWith("/think")) {
      last.content = "/think\n" + last.content;
    }
  }

  return msgs;
}

async function sendChat() {
  const url = document.getElementById("serverUrl").value.replace(/\/+$/, "");
  const btn = document.getElementById("sendBtn");
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> Gonderiliyor...';
  showLoading();

  let body;
  const rawTab = document.getElementById("chatRaw");
  const rawJson = document.getElementById("chatRawJson");
  if (rawTab && rawTab.classList.contains("active") && rawJson && rawJson.value.trim()) {
    try {
      body = JSON.parse(rawJson.value);
    } catch(e) {
      showError("JSON parse hatasi: " + e.message);
      btn.disabled = false;
      btn.textContent = "Gonder";
      return;
    }
  } else {
    body = {
      model: document.getElementById("chatModel").value,
      messages: getMessages(),
      stream: document.getElementById("chatStream")?.checked || false,
      options: getOptions()
    };
    const format = document.getElementById("chatFormat").value;
    if (format) body.format = format;
    const tools = getTools();
    if (tools.length > 0) body.tools = tools;
    const keepAlive = document.getElementById("opt_keep_alive")?.value;
    if (keepAlive) body.keep_alive = keepAlive;
  }

  const start = Date.now();
  try {
    const r = await fetch(url + "/api/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body)
    });
    const data = await r.json();
    const elapsed = Date.now() - start;
    showResponse(r.status, data, elapsed, "chat");
  } catch(e) {
    showError("Baglanti hatasi: " + e.message);
  }
  btn.disabled = false;
  btn.textContent = "Gonder";
}

// ===== GENERATE FORM =====
function renderGenerateForm(ep) {
  return `
    <div class="endpoint-title">${ep.title}</div>
    <div class="endpoint-path">${ep.method} ${ep.path}</div>
    <div class="endpoint-desc">${ep.desc}</div>

    <div class="presets">
      <span class="preset-chip" onclick="applyPreset('creative')">Yaratici</span>
      <span class="preset-chip" onclick="applyPreset('precise')">Kesin/Teknik</span>
      <span class="preset-chip" onclick="applyPreset('balanced')">Dengeli</span>
      <span class="preset-chip" onclick="applyPreset('code')">Kod Yazimi</span>
    </div>

    <div class="form-group">
      <label class="form-label">Model</label>
      ${modelSelect("genModel", "qwen3:4b", m => !m.includes("embed"))}
    </div>

    <div class="form-group">
      <label class="form-label">System Prompt (opsiyonel)</label>
      <textarea class="form-textarea" id="genSystem" rows="2" placeholder="Model davranisini belirleyen talimat..."></textarea>
    </div>

    <div class="form-group">
      <label class="form-label">Prompt</label>
      <textarea class="form-textarea" id="genPrompt" rows="4" placeholder="Metninizi girin...">Turkiye'nin en buyuk 5 sehrini listele.</textarea>
    </div>

    <div style="margin-top:8px;">
      ${toggle("genThinking", "Thinking Mode (/think)", false)}
      ${toggle("genStream", "Stream", false)}
      ${toggle("genRaw", "Raw Mode (template uygulanmaz)", false)}
      <div class="form-group">
        <label class="form-label">Format</label>
        <select class="form-select" id="genFormat">
          <option value="">Serbest metin</option>
          <option value="json">JSON</option>
        </select>
      </div>
    </div>

    ${optionsAccordion()}

    <div style="margin-top:20px; display:flex; gap:8px;">
      <button class="btn btn-primary" id="sendBtn" onclick="sendGenerate()">Gonder</button>
      <button class="btn btn-secondary" onclick="showCurl('generate')">cURL Goster</button>
    </div>
  `;
}

async function sendGenerate() {
  const url = document.getElementById("serverUrl").value.replace(/\/+$/, "");
  const btn = document.getElementById("sendBtn");
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> Gonderiliyor...';
  showLoading();

  let prompt = document.getElementById("genPrompt").value;
  const thinking = document.getElementById("genThinking");
  if (thinking && thinking.checked && !prompt.startsWith("/think")) {
    prompt = "/think\n" + prompt;
  }

  const body = {
    model: document.getElementById("genModel").value,
    prompt: prompt,
    stream: document.getElementById("genStream")?.checked || false,
    options: getOptions()
  };
  const sys = document.getElementById("genSystem")?.value;
  if (sys) body.system = sys;
  const format = document.getElementById("genFormat").value;
  if (format) body.format = format;
  if (document.getElementById("genRaw")?.checked) body.raw = true;
  const keepAlive = document.getElementById("opt_keep_alive")?.value;
  if (keepAlive) body.keep_alive = keepAlive;

  const start = Date.now();
  try {
    const r = await fetch(url + "/api/generate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body)
    });
    const data = await r.json();
    const elapsed = Date.now() - start;
    showResponse(r.status, data, elapsed, "generate");
  } catch(e) {
    showError("Baglanti hatasi: " + e.message);
  }
  btn.disabled = false;
  btn.textContent = "Gonder";
}

// ===== EMBED FORM =====
function renderEmbedForm(ep) {
  return `
    <div class="endpoint-title">${ep.title}</div>
    <div class="endpoint-path">${ep.method} ${ep.path}</div>
    <div class="endpoint-desc">${ep.desc}</div>

    <div class="form-group">
      <label class="form-label">Model</label>
      ${modelSelect("embedModel", "nomic-embed-text", m => m.includes("embed") || m.includes("minilm") || m.includes("mxbai"))}
    </div>

    <div class="form-group">
      <label class="form-label">Metin(ler)</label>
      <textarea class="form-textarea" id="embedInput" rows="4" placeholder="Embedding uretilecek metin...">Merhaba dunya</textarea>
      <div class="form-hint">Her satir ayri bir embedding olur (coklu mod)</div>
    </div>

    ${toggle("embedTruncate", "Truncate (uzun metni kes)", true)}

    <div style="margin-top:20px; display:flex; gap:8px;">
      <button class="btn btn-primary" id="sendBtn" onclick="sendEmbed()">Gonder</button>
    </div>
  `;
}

async function sendEmbed() {
  const url = document.getElementById("serverUrl").value.replace(/\/+$/, "");
  const btn = document.getElementById("sendBtn");
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> Gonderiliyor...';
  showLoading();

  const lines = document.getElementById("embedInput").value.split("\n").filter(l => l.trim());
  const body = {
    model: document.getElementById("embedModel").value,
    input: lines.length === 1 ? lines[0] : lines,
    truncate: document.getElementById("embedTruncate")?.checked ?? true
  };

  const start = Date.now();
  try {
    const r = await fetch(url + "/api/embed", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body)
    });
    const data = await r.json();
    const elapsed = Date.now() - start;
    showResponse(r.status, data, elapsed, "embed");
  } catch(e) {
    showError("Baglanti hatasi: " + e.message);
  }
  btn.disabled = false;
  btn.textContent = "Gonder";
}

// ===== SIMPLE GET =====
function renderSimpleGet(ep) {
  return `
    <div class="endpoint-title">${ep.title}</div>
    <div class="endpoint-path">${ep.method} ${ep.path}</div>
    <div class="endpoint-desc">${ep.desc}</div>
    <button class="btn btn-primary" id="sendBtn" onclick="sendSimpleGet('${ep.path}')">Gonder</button>
  `;
}

async function sendSimpleGet(path) {
  const url = document.getElementById("serverUrl").value.replace(/\/+$/, "");
  const btn = document.getElementById("sendBtn");
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span>';
  showLoading();
  const start = Date.now();
  try {
    const r = await fetch(url + path);
    const ct = r.headers.get("content-type") || "";
    let data;
    if (ct.includes("json")) data = await r.json();
    else data = await r.text();
    showResponse(r.status, data, Date.now() - start, "simple");
  } catch(e) {
    showError("Baglanti hatasi: " + e.message);
  }
  btn.disabled = false;
  btn.textContent = "Gonder";
}

// ===== SHOW FORM =====
function renderShowForm(ep) {
  return `
    <div class="endpoint-title">${ep.title}</div>
    <div class="endpoint-path">${ep.method} ${ep.path}</div>
    <div class="endpoint-desc">${ep.desc}</div>
    <div class="form-group">
      <label class="form-label">Model</label>
      ${modelSelect("showModel", "qwen3:4b")}
    </div>
    ${toggle("showVerbose", "Verbose (tensor bilgileri dahil)", false)}
    <div style="margin-top:16px;">
      <button class="btn btn-primary" id="sendBtn" onclick="sendShow()">Gonder</button>
    </div>
  `;
}

async function sendShow() {
  const url = document.getElementById("serverUrl").value.replace(/\/+$/, "");
  const btn = document.getElementById("sendBtn");
  btn.disabled = true; btn.innerHTML = '<span class="spinner"></span>';
  showLoading();
  const start = Date.now();
  try {
    const r = await fetch(url + "/api/show", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        model: document.getElementById("showModel").value,
        verbose: document.getElementById("showVerbose")?.checked || false
      })
    });
    const data = await r.json();
    showResponse(r.status, data, Date.now() - start, "show");
  } catch(e) { showError(e.message); }
  btn.disabled = false; btn.textContent = "Gonder";
}

// ===== PULL FORM =====
function renderPullForm(ep) {
  return `
    <div class="endpoint-title">${ep.title}</div>
    <div class="endpoint-path">${ep.method} ${ep.path}</div>
    <div class="endpoint-desc">${ep.desc}</div>
    <div class="form-group">
      <label class="form-label">Model Adi</label>
      <input class="form-input" id="pullModel" value="qwen3:4b" placeholder="qwen3:4b, llama3:8b, ...">
    </div>
    <button class="btn btn-primary" id="sendBtn" onclick="sendPull()">Indir</button>
  `;
}

async function sendPull() {
  const url = document.getElementById("serverUrl").value.replace(/\/+$/, "");
  const btn = document.getElementById("sendBtn");
  btn.disabled = true; btn.innerHTML = '<span class="spinner"></span> Indiriliyor...';
  showLoading();
  const start = Date.now();
  try {
    const r = await fetch(url + "/api/pull", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ model: document.getElementById("pullModel").value, stream: false })
    });
    const data = await r.json();
    showResponse(r.status, data, Date.now() - start, "simple");
    checkServer(); // model listesini guncelle
  } catch(e) { showError(e.message); }
  btn.disabled = false; btn.textContent = "Indir";
}

// ===== CREATE FORM =====
function renderCreateForm(ep) {
  return `
    <div class="endpoint-title">${ep.title}</div>
    <div class="endpoint-path">${ep.method} ${ep.path}</div>
    <div class="endpoint-desc">${ep.desc}</div>
    <div class="form-group">
      <label class="form-label">Yeni Model Adi</label>
      <input class="form-input" id="createName" placeholder="turkish-qwen">
    </div>
    <div class="form-group">
      <label class="form-label">Modelfile</label>
      <textarea class="form-textarea" id="createModelfile" rows="8">FROM qwen3:4b
SYSTEM "Sen yardimsever bir Turkce asistansin. Her zaman Turkce yanit ver."
PARAMETER temperature 0.7
PARAMETER top_p 0.9
PARAMETER num_ctx 8192</textarea>
    </div>
    <button class="btn btn-primary" id="sendBtn" onclick="sendCreate()">Olustur</button>
  `;
}

async function sendCreate() {
  const url = document.getElementById("serverUrl").value.replace(/\/+$/, "");
  const btn = document.getElementById("sendBtn");
  btn.disabled = true; btn.innerHTML = '<span class="spinner"></span>';
  showLoading();
  const start = Date.now();
  try {
    const r = await fetch(url + "/api/create", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        model: document.getElementById("createName").value,
        modelfile: document.getElementById("createModelfile").value,
        stream: false
      })
    });
    const data = await r.json();
    showResponse(r.status, data, Date.now() - start, "simple");
    checkServer();
  } catch(e) { showError(e.message); }
  btn.disabled = false; btn.textContent = "Olustur";
}

// ===== COPY FORM =====
function renderCopyForm(ep) {
  return `
    <div class="endpoint-title">${ep.title}</div>
    <div class="endpoint-path">${ep.method} ${ep.path}</div>
    <div class="endpoint-desc">${ep.desc}</div>
    <div class="form-group">
      <label class="form-label">Kaynak Model</label>
      ${modelSelect("copySource", "qwen3:4b")}
    </div>
    <div class="form-group">
      <label class="form-label">Hedef Model Adi</label>
      <input class="form-input" id="copyDest" placeholder="qwen3-backup:4b">
    </div>
    <button class="btn btn-primary" id="sendBtn" onclick="sendCopy()">Kopyala</button>
  `;
}

async function sendCopy() {
  const url = document.getElementById("serverUrl").value.replace(/\/+$/, "");
  const btn = document.getElementById("sendBtn");
  btn.disabled = true; btn.innerHTML = '<span class="spinner"></span>';
  showLoading();
  const start = Date.now();
  try {
    const r = await fetch(url + "/api/copy", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        source: document.getElementById("copySource").value,
        destination: document.getElementById("copyDest").value
      })
    });
    showResponse(r.status, r.ok ? {status: "success"} : await r.json(), Date.now() - start, "simple");
    checkServer();
  } catch(e) { showError(e.message); }
  btn.disabled = false; btn.textContent = "Kopyala";
}

// ===== DELETE FORM =====
function renderDeleteForm(ep) {
  return `
    <div class="endpoint-title">${ep.title}</div>
    <div class="endpoint-path">${ep.method} ${ep.path}</div>
    <div class="endpoint-desc">${ep.desc}</div>
    <div class="form-group">
      <label class="form-label">Silinecek Model</label>
      ${modelSelect("deleteModel", "qwen3:4b")}
    </div>
    <div style="color:var(--red); font-size:13px; margin-bottom:12px;">Dikkat: Bu islem geri alinamaz!</div>
    <button class="btn btn-primary" style="background:var(--red);" id="sendBtn" onclick="if(confirm('Modeli silmek istediginize emin misiniz?')) sendDelete()">Sil</button>
  `;
}

async function sendDelete() {
  const url = document.getElementById("serverUrl").value.replace(/\/+$/, "");
  const btn = document.getElementById("sendBtn");
  btn.disabled = true; btn.innerHTML = '<span class="spinner"></span>';
  showLoading();
  const start = Date.now();
  try {
    const r = await fetch(url + "/api/delete", {
      method: "DELETE",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ model: document.getElementById("deleteModel").value })
    });
    showResponse(r.status, r.ok ? {status: "deleted"} : await r.json(), Date.now() - start, "simple");
    checkServer();
  } catch(e) { showError(e.message); }
  btn.disabled = false; btn.textContent = "Sil";
}

// ===== PRESETS =====
function applyPreset(name) {
  const presets = {
    creative:  { temperature: 0.9, top_p: 0.95, top_k: 40, repeat_penalty: 1.1 },
    precise:   { temperature: 0.2, top_p: 0.8, top_k: 10, repeat_penalty: 1.0 },
    balanced:  { temperature: 0.6, top_p: 0.95, top_k: 20, repeat_penalty: 1.0 },
    code:      { temperature: 0.3, top_p: 0.9, top_k: 15, repeat_penalty: 1.05 }
  };
  const p = presets[name];
  if (!p) return;
  for (const [key, val] of Object.entries(p)) {
    const el = document.getElementById("opt_" + key);
    if (el) {
      el.value = val;
      const valEl = document.getElementById("opt_" + key + "_val");
      if (valEl) valEl.textContent = val;
    }
  }
  // Accordion'u aç
  const acc = document.getElementById("optionsAccordion");
  if (acc) acc.classList.add("open");
}

// ===== TABS =====
function switchTab(tabEl, contentId) {
  tabEl.parentElement.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
  tabEl.classList.add("active");
  const parent = tabEl.closest(".main") || document.getElementById("mainContent");
  parent.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
  document.getElementById(contentId).classList.add("active");
}

// ===== RESPONSE =====
function showLoading() {
  document.getElementById("responseBody").innerHTML = '<div style="text-align:center;padding:40px;"><span class="spinner" style="width:30px;height:30px;border-width:3px;"></span><div style="margin-top:12px;color:var(--text2);">Yanit bekleniyor...</div></div>';
  document.getElementById("respStatus").style.display = "none";
  document.getElementById("responseMeta").style.display = "none";
}

function showError(msg) {
  const st = document.getElementById("respStatus");
  st.textContent = "HATA";
  st.className = "response-status s400";
  st.style.display = "inline-block";
  document.getElementById("responseBody").innerHTML = `<div style="color:var(--red);padding:12px;">${msg}</div>`;
  document.getElementById("responseMeta").style.display = "none";
}

function showResponse(status, data, elapsed, type) {
  const st = document.getElementById("respStatus");
  st.textContent = status;
  st.className = "response-status " + (status >= 200 && status < 300 ? "s200" : status >= 400 && status < 500 ? "s400" : "s404");
  st.style.display = "inline-block";

  const body = document.getElementById("responseBody");
  const meta = document.getElementById("responseMeta");

  // Parsed response vs raw
  if (type === "chat" && data.message) {
    let html = "";
    const content = data.message.content || "";

    // Thinking block
    const thinkMatch = content.match(/<think>([\s\S]*?)<\/think>/);
    if (thinkMatch) {
      html += `<div class="thinking-block"><div class="thinking-label">Thinking</div>${escapeHtml(thinkMatch[1].trim())}</div>`;
    }

    // Main content
    const mainContent = content.replace(/<think>[\s\S]*?<\/think>\s*/, "").trim();
    if (mainContent) {
      html += `<div class="response-text">${escapeHtml(mainContent)}</div>`;
    }

    // Tool calls
    if (data.message.tool_calls && data.message.tool_calls.length > 0) {
      html += `<div style="margin-top:12px;"><div class="thinking-label" style="color:var(--orange);">Tool Calls</div>`;
      data.message.tool_calls.forEach(tc => {
        html += `<div style="background:var(--surface2);padding:12px;border-radius:8px;margin-top:8px;font-family:monospace;font-size:13px;">
          <strong>${tc.function.name}</strong>(${JSON.stringify(tc.function.arguments, null, 2)})
        </div>`;
      });
      html += `</div>`;
    }

    html += `<details style="margin-top:16px;"><summary style="cursor:pointer;color:var(--text2);font-size:12px;">Raw JSON</summary><pre class="response-pre" style="margin-top:8px;">${escapeHtml(JSON.stringify(data, null, 2))}</pre></details>`;
    body.innerHTML = html;

  } else if (type === "generate" && data.response !== undefined) {
    let html = "";
    const content = data.response || "";
    const thinkMatch = content.match(/<think>([\s\S]*?)<\/think>/);
    if (thinkMatch) {
      html += `<div class="thinking-block"><div class="thinking-label">Thinking</div>${escapeHtml(thinkMatch[1].trim())}</div>`;
    }
    const mainContent = content.replace(/<think>[\s\S]*?<\/think>\s*/, "").trim();
    if (mainContent) {
      html += `<div class="response-text">${escapeHtml(mainContent)}</div>`;
    }
    html += `<details style="margin-top:16px;"><summary style="cursor:pointer;color:var(--text2);font-size:12px;">Raw JSON</summary><pre class="response-pre" style="margin-top:8px;">${escapeHtml(JSON.stringify(data, null, 2))}</pre></details>`;
    body.innerHTML = html;

  } else if (type === "embed" && data.embeddings) {
    let html = `<div style="margin-bottom:12px;"><strong>Model:</strong> ${data.model || "?"} | <strong>Boyut:</strong> ${data.embeddings[0]?.length || 0} boyut | <strong>Adet:</strong> ${data.embeddings.length}</div>`;
    data.embeddings.forEach((emb, i) => {
      html += `<details ${i===0?'open':''}><summary style="cursor:pointer;font-size:13px;">Embedding #${i+1} (${emb.length} boyut)</summary><pre class="response-pre" style="margin-top:4px;max-height:200px;overflow-y:auto;">[${emb.slice(0, 20).map(v => v.toFixed(6)).join(", ")}${emb.length > 20 ? ', ...' : ''}]</pre></details>`;
    });
    html += `<details style="margin-top:12px;"><summary style="cursor:pointer;color:var(--text2);font-size:12px;">Raw JSON</summary><pre class="response-pre" style="margin-top:8px;">${escapeHtml(JSON.stringify(data, null, 2))}</pre></details>`;
    body.innerHTML = html;

  } else {
    body.innerHTML = `<pre class="response-pre">${escapeHtml(typeof data === "string" ? data : JSON.stringify(data, null, 2))}</pre>`;
  }

  // Meta
  meta.style.display = "flex";
  let metaHtml = `<div class="meta-item">Sure: <span>${elapsed}ms</span></div>`;
  if (data.total_duration) metaHtml += `<div class="meta-item">Toplam: <span>${(data.total_duration/1e9).toFixed(2)}s</span></div>`;
  if (data.prompt_eval_count) metaHtml += `<div class="meta-item">Prompt: <span>${data.prompt_eval_count} token</span></div>`;
  if (data.eval_count) metaHtml += `<div class="meta-item">Uretilen: <span>${data.eval_count} token</span></div>`;
  if (data.eval_duration && data.eval_count) {
    const tps = data.eval_count / (data.eval_duration / 1e9);
    metaHtml += `<div class="meta-item">Hiz: <span>${tps.toFixed(1)} token/s</span></div>`;
  }
  meta.innerHTML = metaHtml;
}

function escapeHtml(str) {
  return str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");
}

// ===== CURL =====
function showCurl(type) {
  const url = document.getElementById("serverUrl").value.replace(/\/+$/, "");
  let body, path;

  if (type === "chat") {
    path = "/api/chat";
    const rawTab = document.getElementById("chatRaw");
    const rawJson = document.getElementById("chatRawJson");
    if (rawTab && rawTab.classList.contains("active") && rawJson && rawJson.value.trim()) {
      body = rawJson.value;
    } else {
      const b = {
        model: document.getElementById("chatModel").value,
        messages: getMessages(),
        stream: document.getElementById("chatStream")?.checked || false,
        options: getOptions()
      };
      const format = document.getElementById("chatFormat").value;
      if (format) b.format = format;
      const tools = getTools();
      if (tools.length > 0) b.tools = tools;
      body = JSON.stringify(b, null, 2);
    }
  } else if (type === "generate") {
    path = "/api/generate";
    let prompt = document.getElementById("genPrompt").value;
    const thinking = document.getElementById("genThinking");
    if (thinking && thinking.checked && !prompt.startsWith("/think")) prompt = "/think\\n" + prompt;
    const b = {
      model: document.getElementById("genModel").value,
      prompt: prompt,
      stream: document.getElementById("genStream")?.checked || false,
      options: getOptions()
    };
    const sys = document.getElementById("genSystem")?.value;
    if (sys) b.system = sys;
    const format = document.getElementById("genFormat").value;
    if (format) b.format = format;
    body = JSON.stringify(b, null, 2);
  }

  const curl = `curl -s ${url}${path} \\\n  -H "Content-Type: application/json" \\\n  -d '${body}'`;
  document.getElementById("responseBody").innerHTML = `<div style="margin-bottom:8px;font-weight:600;font-size:13px;">cURL Komutu:</div><pre class="response-pre" style="user-select:all;">${escapeHtml(curl)}</pre><button class="btn btn-sm btn-secondary" style="margin-top:12px;" onclick="navigator.clipboard.writeText(this.previousElementSibling.textContent)">Kopyala</button>`;
  document.getElementById("respStatus").style.display = "none";
  document.getElementById("responseMeta").style.display = "none";
}

// ===== START =====
init();
</script>
</body>
</html>
